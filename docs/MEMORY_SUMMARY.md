# è®°å¿†æ‘˜è¦ç³»ç»Ÿ

## æ¦‚è¿°

åŸºäº LLM çš„è®°å¿†æ‘˜è¦ç³»ç»Ÿï¼Œé€šè¿‡æ™ºèƒ½å‹ç¼©å†å²æ¡ˆä¾‹ï¼Œå®ç°ï¼š
- **å‡å°‘å­˜å‚¨ç©ºé—´**ï¼šå°†æ•°ç™¾ä¸ªè¯¦ç»†æ¡ˆä¾‹å‹ç¼©ä¸ºç®€æ´æ‘˜è¦
- **æå–æ ¸å¿ƒç»éªŒ**ï¼šLLM åˆ†æå¹¶æ€»ç»“å…³é”®æ¨¡å¼å’Œç»éªŒ
- **æå‡å†³ç­–è´¨é‡**ï¼šæ‘˜è¦æä¾›æ›´é«˜å±‚æ¬¡çš„å¸‚åœºæ´å¯Ÿ

## æ¶æ„è®¾è®¡

### åˆ†å±‚è®°å¿†ç»“æ„

```
çŸ­æœŸè®°å¿† (7å¤©)          ä¸­æœŸè®°å¿† (æ¯å‘¨)         é•¿æœŸè®°å¿† (å†å²æ‘˜è¦)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
è¯¦ç»†æ¡ˆä¾‹              â†’  æ¯å‘¨æ‘˜è¦            â†’  æ ¸å¿ƒç»éªŒåº“
~500ä¸ªæ¡ˆä¾‹ (2.8MB)      ~4ä¸ªæ‘˜è¦ (20KB)         æ°¸ä¹…ä¿ç•™
æ¯ä¸ª3-6KB               å‹ç¼©ç‡: 99%              é«˜åº¦æç‚¼
```

### æ‘˜è¦å†…å®¹

æ¯ä¸ªæ‘˜è¦åŒ…å«ï¼š

**1. ç»Ÿè®¡æ•°æ®**
- æ¡ˆä¾‹æ•°ã€äº¤æ˜“æ•°ã€èƒœç‡
- å¹³å‡ç›ˆäºã€å¤æ™®æ¯”ç‡

**2. LLM åˆ†æ** (è‡ªåŠ¨ç”Ÿæˆ)
- **å…³é”®æ¨¡å¼**: å‘ç°çš„äº¤æ˜“æ¨¡å¼ (3-5ä¸ª)
- **æˆåŠŸç­–ç•¥**: æ•ˆæœå¥½çš„ç­–ç•¥ (2-3ä¸ª)
- **å¤±è´¥ç­–ç•¥**: éœ€è¦é¿å…çš„ç­–ç•¥ (2-3ä¸ª)
- **æ ¸å¿ƒç»éªŒ**: æœ€é‡è¦çš„ç»éªŒæ•™è®­ (3-5æ¡)
- **å¸‚åœºæ´å¯Ÿ**: è¿™æ®µæ—¶é—´çš„å¸‚åœºçŠ¶æ€æ€»ç»“

**3. å…ƒæ•°æ®**
- æ—¶é—´èŒƒå›´ã€æ‘˜è¦IDã€åˆ›å»ºæ—¶é—´

## ä½¿ç”¨æ–¹æ³•

### è‡ªåŠ¨ç”Ÿæˆæ‘˜è¦

ç³»ç»Ÿä¼šåœ¨é€‚å½“æ—¶å€™è‡ªåŠ¨ç”Ÿæˆæ‘˜è¦ï¼ˆæœªæ¥ç‰ˆæœ¬å®ç°ï¼‰ã€‚

### æ‰‹åŠ¨ç”Ÿæˆæ‘˜è¦

```bash
# ç”Ÿæˆæ¯å‘¨æ‘˜è¦
uv run python generate_summary.py
```

è¿™ä¼šï¼š
1. åˆ†ææœ€è¿‘7å¤©çš„æ¡ˆä¾‹ï¼ˆè‡³å°‘éœ€è¦5ä¸ªï¼‰
2. ä½¿ç”¨ LLM ç”Ÿæˆæ‘˜è¦
3. ä¿å­˜æ‘˜è¦åˆ° `data/memory/summaries.json`
4. åˆ é™¤å·²æ‘˜è¦çš„æ—§æ¡ˆä¾‹ï¼ˆèŠ‚çœç©ºé—´ï¼‰

### æŸ¥çœ‹æ‘˜è¦

```bash
# æŸ¥çœ‹æ‰€æœ‰æ‘˜è¦
cat data/memory/summaries.json | jq '.'

# æŸ¥çœ‹æœ€æ–°æ‘˜è¦
cat data/memory/summaries.json | jq '.[-1]'

# æŸ¥çœ‹æ‘˜è¦çš„å…³é”®æ¨¡å¼
cat data/memory/summaries.json | jq '.[-1].key_patterns'
```

## æ‘˜è¦ç¤ºä¾‹

```json
{
  "period_start": "2025-11-13T00:00:00",
  "period_end": "2025-11-20T00:00:00",
  "period_type": "weekly",
  "total_cases": 156,
  "total_trades": 12,
  "win_rate": 0.58,
  "avg_pnl": 12.5,
  "sharpe_ratio": 0.45,
  "key_patterns": [
    "BTCåœ¨EMA20ä¸Šæ–¹æ—¶å¼€å¤šèƒœç‡æ›´é«˜",
    "éœ‡è¡å¸‚ä¸­å‡å°‘äº¤æ˜“é¢‘ç‡å¯æå‡å¤æ™®æ¯”ç‡",
    "æ­¢æŸè®¾ç½®åœ¨ATRçš„1.5å€æ•ˆæœè¾ƒå¥½"
  ],
  "successful_strategies": [
    "è¶‹åŠ¿è·Ÿéšç­–ç•¥åœ¨å•è¾¹è¡Œæƒ…ä¸­è¡¨ç°ä¼˜å¼‚",
    "ç»“åˆRSIå’ŒMACDçš„åŒé‡ç¡®è®¤å‡å°‘å‡ä¿¡å·"
  ],
  "failed_strategies": [
    "é€†åŠ¿æŠ„åº•åœ¨å¼ºè¶‹åŠ¿ä¸­æŸå¤±è¾ƒå¤§",
    "è¿‡åº¦ä¾èµ–å•ä¸€æŒ‡æ ‡å¯¼è‡´è¯¯åˆ¤"
  ],
  "lessons": [
    "ç­‰å¾…å¤šé‡ä¿¡å·ç¡®è®¤æ¯”æŠ¢å…ˆå…¥åœºæ›´é‡è¦",
    "è®¾ç½®æ­¢æŸæ˜¯ä¿æŠ¤èµ„é‡‘çš„æœ€åé˜²çº¿",
    "å¸‚åœºéœ‡è¡æ—¶ä¿æŒè€å¿ƒè§‚æœ›"
  ],
  "market_insights": "æœ¬å‘¨BTCå’ŒETHæ•´ä½“éœ‡è¡åå¼±ï¼Œç¼ºä¹æ˜ç¡®æ–¹å‘ã€‚æˆäº¤é‡èç¼©æ˜¾ç¤ºå¸‚åœºè§‚æœ›æƒ…ç»ªæµ“åšï¼Œå»ºè®®ç­‰å¾…æ›´å¼ºçƒˆçš„è¶‹åŠ¿ä¿¡å·ã€‚",
  "summary_id": "weekly_20251113",
  "created_at": "2025-11-20T18:00:00"
}
```

## å­˜å‚¨ä¼˜åŒ–

### å‹ç¼©æ•ˆæœå¯¹æ¯”

| å­˜å‚¨æ–¹å¼ | æ¡ˆä¾‹æ•° | æ–‡ä»¶å¤§å° | å‹ç¼©ç‡ |
|---------|--------|---------|--------|
| è¯¦ç»†æ¡ˆä¾‹ï¼ˆåŸå§‹ï¼‰ | 1000 | 5.6 MB | - |
| æ¯å‘¨æ‘˜è¦ï¼ˆ7å¤©ä¸€æ¬¡ï¼‰ | 52 | 260 KB | 95% |
| è¯¦ç»†æ¡ˆä¾‹ï¼ˆä»…ä¿ç•™7å¤©ï¼‰ + æ‘˜è¦ | 100 + 52 | 560 KB + 260 KB = 820 KB | 85% |

### é•¿æœŸå­˜å‚¨é¢„ä¼°

**ä¸€å¹´è¿è¡Œæ•°æ®**ï¼š

| æ–¹æ¡ˆ | è¯¦ç»†æ¡ˆä¾‹ | æ‘˜è¦ | æ€»å¤§å° |
|------|----------|------|--------|
| æ— å‹ç¼© | 175,200ä¸ª | 0ä¸ª | 982 MB |
| æ‘˜è¦ç³»ç»Ÿ | æœ€å¤š500ä¸ª | 52ä¸ª | 2.8 MB + 260 KB â‰ˆ **3 MB** |

**å‹ç¼©ç‡: 99.7%** ğŸ‰

## å·¥ä½œæµç¨‹

### æ¡ˆä¾‹ç”Ÿæˆ â†’ æ‘˜è¦ â†’ æ¸…ç†

```
æ¯å¤©:
  1. ç§¯ç´¯æ–°æ¡ˆä¾‹ (480ä¸ª/å¤©)
  2. è¶…è¿‡é˜ˆå€¼æ—¶è‡ªåŠ¨æ¸…ç†æ—§æ¡ˆä¾‹

æ¯å‘¨:
  1. è¿è¡Œ generate_summary.py
  2. LLM åˆ†æ7å¤©çš„æ¡ˆä¾‹
  3. ç”Ÿæˆæ‘˜è¦
  4. åˆ é™¤å·²æ‘˜è¦çš„æ¡ˆä¾‹
  5. ä¿ç•™æ‘˜è¦å’Œæœ€è¿‘7å¤©çš„è¯¦ç»†æ¡ˆä¾‹
```

### LLM å†³ç­–ä½¿ç”¨æ‘˜è¦

å†³ç­–æ—¶ï¼Œ`to_context()` ä¼šè¿”å›ï¼š

```markdown
## å†å²è®°å¿†

### å†å²ç»éªŒæ€»ç»“

#### æ¯å‘¨æ‘˜è¦ (2025-11-13 - 2025-11-20)
- äº¤æ˜“: 12 æ¬¡, èƒœç‡ 58.0%, å¤æ™® 0.45
- **å…³é”®æ¨¡å¼**:
  - BTCåœ¨EMA20ä¸Šæ–¹æ—¶å¼€å¤šèƒœç‡æ›´é«˜
  - éœ‡è¡å¸‚ä¸­å‡å°‘äº¤æ˜“é¢‘ç‡å¯æå‡å¤æ™®æ¯”ç‡
- **æˆåŠŸç­–ç•¥**:
  - è¶‹åŠ¿è·Ÿéšç­–ç•¥åœ¨å•è¾¹è¡Œæƒ…ä¸­è¡¨ç°ä¼˜å¼‚
- **æ ¸å¿ƒç»éªŒ**:
  - ç­‰å¾…å¤šé‡ä¿¡å·ç¡®è®¤æ¯”æŠ¢å…ˆå…¥åœºæ›´é‡è¦
  - è®¾ç½®æ­¢æŸæ˜¯ä¿æŠ¤èµ„é‡‘çš„æœ€åé˜²çº¿

### æœ€è¿‘ 7 å¤©è¡¨ç°
- äº¤æ˜“æ¬¡æ•°: 82
- å¹³å‡ç›ˆäº: $8.50
- å¤æ™®æ¯”ç‡: 0.32
- èƒœç‡: 52.4%

### ç›¸ä¼¼å†å²æ¡ˆä¾‹
...
```

è¿™æ · LLM èƒ½åŒæ—¶è·å¾—ï¼š
1. **é«˜å±‚æ¬¡ç»éªŒ** (æ‘˜è¦) - ç”¨äºæˆ˜ç•¥å†³ç­–
2. **æœ€è¿‘æ•°æ®** (çŸ­æœŸè®°å¿†) - ç”¨äºæˆ˜æœ¯è°ƒæ•´
3. **ç›¸ä¼¼æ¡ˆä¾‹** (æ£€ç´¢) - ç”¨äºå‚è€ƒå€Ÿé‰´

## é…ç½®é€‰é¡¹

åœ¨ `config/config.yaml.example` ä¸­ï¼š

```yaml
memory:
  max_cases: 1000           # æœ€å¤šä¿ç•™æ¡ˆä¾‹æ•°
  keep_recent_days: 30      # ä¿ç•™æœ€è¿‘Nå¤©
  enable_auto_cleanup: true # å¯ç”¨è‡ªåŠ¨æ¸…ç†
  enable_archiving: true    # å¯ç”¨å½’æ¡£
```

## é«˜çº§åŠŸèƒ½ï¼ˆæœªæ¥ï¼‰

### è‡ªåŠ¨åŒ–æ‘˜è¦ç”Ÿæˆ

åœ¨ `learning_graph.py` ä¸­æ·»åŠ å®šæ—¶ä»»åŠ¡ï¼š

```python
async def run_loop(self, ...):
    iteration = 0
    last_summary_time = datetime.now()

    while True:
        await self.run_iteration(symbols, iteration)

        # æ¯å‘¨è‡ªåŠ¨ç”Ÿæˆæ‘˜è¦
        if (datetime.now() - last_summary_time).days >= 7:
            await self.memory.generate_weekly_summary()
            last_summary_time = datetime.now()

        iteration += 1
```

### åˆ†å±‚æ‘˜è¦

- **æ¯å‘¨æ‘˜è¦**: è¯¦ç»†çš„æ¨¡å¼å’Œç»éªŒ
- **æ¯æœˆæ‘˜è¦**: å‘¨æ‘˜è¦çš„å†æç‚¼
- **å­£åº¦æ‘˜è¦**: æœˆæ‘˜è¦çš„æ ¸å¿ƒæ€»ç»“

### å‘é‡æ£€ç´¢

ä½¿ç”¨ ChromaDB å¯¹æ‘˜è¦è¿›è¡Œå‘é‡åŒ–ï¼š

```python
# å°†æ‘˜è¦è½¬ä¸ºå‘é‡
summary_text = f"{summary.key_patterns} {summary.lessons}"
embedding = embed(summary_text)

# æ£€ç´¢ç›¸ä¼¼æ‘˜è¦
similar_summaries = chroma.search(query_embedding, k=3)
```

## æœ€ä½³å®è·µ

1. **å®šæœŸç”Ÿæˆæ‘˜è¦**
   - æ¯å‘¨è‡³å°‘è¿è¡Œä¸€æ¬¡ `generate_summary.py`
   - é¿å…æ¡ˆä¾‹ç§¯ç´¯è¿‡å¤šå½±å“æ€§èƒ½

2. **å®¡æŸ¥æ‘˜è¦è´¨é‡**
   - æ£€æŸ¥ LLM ç”Ÿæˆçš„ç»éªŒæ˜¯å¦åˆç†
   - å¯ä»¥æ‰‹åŠ¨ç¼–è¾‘ `summaries.json` ä¼˜åŒ–å†…å®¹

3. **å¤‡ä»½æ‘˜è¦**
   ```bash
   cp data/memory/summaries.json data/memory/summaries_backup_$(date +%Y%m%d).json
   ```

4. **ç»„åˆä½¿ç”¨**
   - æ‘˜è¦ + æ™ºèƒ½æ¸…ç† + å½’æ¡£ = æœ€ä½³æ–¹æ¡ˆ
   - æ—¢èŠ‚çœç©ºé—´ï¼Œåˆä¿ç•™å…³é”®ä¿¡æ¯

## æ€»ç»“

æ‘˜è¦ç³»ç»Ÿæä¾›äº†ï¼š

âœ… **99%+ çš„ç©ºé—´èŠ‚çœ**
âœ… **LLM é©±åŠ¨çš„ç»éªŒæå–**
âœ… **åˆ†å±‚è®°å¿†æ¶æ„**
âœ… **è‡ªåŠ¨åŒ–å·¥ä½œæµ**
âœ… **æå‡å†³ç­–è´¨é‡**

è¿™æ˜¯ä¸€ä¸ªæ›´ç¬¦åˆäººç±»è®°å¿†ç‰¹ç‚¹çš„ç³»ç»Ÿï¼š**è®°ä½æ¨¡å¼ï¼Œå¿˜è®°ç»†èŠ‚**ã€‚
